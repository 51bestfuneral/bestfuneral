<!DOCTYPE html>
<html>
<head>
<title>念念--服务详细</title>
<meta name="description" content="念念网致力于打造智能葬礼产品和服务定制工具。念念主张“不要让你爱的人走的太匆忙”，鼓励充分尊重逝者意愿的提前定制，已实现“殡葬服务价格透明化、互联网化、个性化”为己任 。念念，也是中国最大的日系骨灰盒骨灰坛销售公司，最有特色的祭扫祭祀用品服务商。" /> 
<meta name="keywords" content="念念,念念网,葬礼定制,殡葬,上海殡葬,殡葬服务,上海墓地， 骨灰盒，骨灰坛，寿衣，日本骨灰盒，葬礼花费，佛事服务，私人定制，生前契约，葬礼保险,提前定制" /> 
<link href="/css/productDetail3.css" rel="stylesheet">
<script src="../js/jquery-2.1.4.js"></script>
<script src="../js/jquery-ui.js"></script>
<script src="../js/angular-1.4.0-rc.2/angular.js"></script>
<script src="/js/generalUsage.js"></script>
<script src="../js/tinymce/tinymce.min.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body onselectstart="return false" ng-app="detailApp" ng-controller="details">
<IFRAME NAME="content_frame" width=100% SRC="component/topBar.html" frameborder = 0 height = "67px"></IFRAME>
<div class="container">

    <div id="topContent">
 	    <div id="topLeft">
		    <div id="photosWall">
			    <div id="photoShow">
				    <div id="photoShowArea">
					    <div style="width: 540px; height: 389px; float: none; position: absolute; opacity: 1; z-index: 1;">
					        <img src="../js/images/{{wish.imgUrl}}"></img>
						</div>
					</div>
					<ul id="sliderPhote" hidden>
					    <li>
						    <div class="singleSlide" id="1">
							    <img src="/js/images/adc126d6c50e9f775fe4e04ab08299a2_4_m.jpg?imageMogr2/thumbnail/!126x86r/gravity/Center/crop/126x86/quality/95"></img>
							</div>
						</li>
						<li>
						    <div class="singleSlide" id="2">
							    <img src="/js/images/b3b17484baf612c2d868a0847972a6ce_0_m.jpg?imageMogr2/thumbnail/!690x294r/gravity/Center/crop/690x294/quality/95"></img>
							</div>
						</li>
						<li>
						    <div class="singleSlide" id="3">
							    <img src="/js/images/b202dfa2144fd97be996123baa2634b2_1_m.jpg?imageMogr2/thumbnail/!690x294r/gravity/Center/crop/690x294/quality/95"></img>
							</div>
						</li>
						<li>
						    <div class="singleSlide" id="4">
							    <img src="/js/images/afa514eb9eb5ebe33f4c939e0328c18b_2_m.jpg?imageMogr2/thumbnail/!690x294r/gravity/Center/crop/690x294/quality/95"></img>
							</div>
						</li>
						<li>
						    <div class="singleSlide" id="5">
							    <img src="/js/images/b1a6e17c9ba6fe18cf2756d1c5d31573_3_m.jpg?imageMogr2/thumbnail/!126x86r/gravity/Center/crop/126x86/quality/95"></img>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div id="topRight">
		    <h3 ng-bind="wish.wishName"></h3>
			<div id="priceArea">
			    <p class="priceFont"><span class="priceBold">￥<span ng-bind="wish.sellingPrice"></span></span>起</p>
				<p class="priceFont normalPriceText">门市价<s>￥<span ng-bind="wish.xianenPrice"></span></s></p>
			</div>
			<div id="commentArea">
			    <div id="buyNumberBox">
				    <span class="buyNum">已有<span class="buyNumberCount">0</span>人购买</span>
				</div>
				<div id="startGroup">
				    <span>
					    <span class="StarEmpty"></span>
						<span class="StartFull"></span>
					</span>
					<span id="commentNum">
					    5分(<span>1</span>)
					</span>
				</div>
			</div>
			<div id="serverDescription">
			    <span ng-bind="wish.remark"></span>
			</div>
			<div id="buyButton">
			    <span id="buyButtonSelf" class="saveToCart">加入购物车</span>
				<span id="addToWishlist" class="addToWishBtn">加入愿望清单</span>
			</div>
		</div>
	</div>
	<div id="middleContent">
	    <div id="middleContainer">
		    <div class="singleNavi">
			    细节描述
			</div>
			<div class="singleNavi">
			    类似产品
			</div>
			<div class="singleNavi">
			    其他类别
			</div>
		</div>
	</div>
	<div id="bottomContent">
	    <div id="bottomLeft">
		    <div>
                 <textarea id="mainText"></textarea>
            </div>
		</div>
		<div id="bottomRight">
		    <div class="headerBar">
			    <div class="priceArea">
				    <span >￥{{wish.sellingPrice}}</span>
				</div>
			</div>
			<div class="InfomationCoat">
			    <span id="productName" ng-bind="wish.wishName"></span>
			    <div class="addToCart saveToCart"><span>加入购物车</span></div>
				<div class="buttonDesc"><span>加入购物车以直接购买</span></div>
			    <div class="addToWish addToWishBtn"><span>加入愿望清单</span></div>
				<div class="buttonDesc"><span>你可以把此项服务添加到愿望清单</span></div>
				<a class="goToOtherPlace">去看看同类别</a>
			</div>
		</div>
	</div>
	<div id="referenceContent">
		<h4>相类似产品</h4>
		<div id="referenceContainer">
			<div class="singleReference" ng-repeat="relevantWish in relevantWishs" id="{{relevantWish.wishId}}">
			    <div class="imageDiv">
				    <image src="../js/images/{{relevantWish.imgUrl}}"></image>
				</div>
				<div class="priceFloat">
				    <span>￥</span><span>{{relevantWish.sellingPrice}}</span>
				</div>
				<div class="addToWishFloat">
				</div>
				<div class="refDesc">
				    <span>{{relevantWish.wishName}}</span>
				</div>
			</div>
		</div>
	</div>
	<div id="otherType">
	    <h4>您还可以看看其他的类别</h4>
		<div id="otherNavi">
		    <a href="catagoryProduct.html?cata=II-JJ">骨灰盒</a>&nbsp;·
			<a href="catagoryProduct.html?cata=SS">寿衣</a>&nbsp;·
			<a href="catagoryProduct.html?cata=M-S-W">祭祀随葬</a>&nbsp;·
			<a href="catagoryProduct.html?cata=G-H-L-T">礼仪服务</a>&nbsp;·
			<a href="catagoryProduct.html?cata=VV-O">祭扫用品</a>&nbsp;·
			<a href="catagoryProduct.html?cata=P-Q-R-U">套装用品</a>&nbsp;·
			<a href="catagoryProduct.html?cata=NN-X-N">其他产品</a>
		</div>
	</div>
<IFRAME NAME="content_frame" width=100% height=246 marginwidth=0 marginheight=0 SRC="component/bottomBar.html" frameborder = 0></IFRAME>
</div>
</body>
<script>
var content = '';
    tinymce.init({ 
	    'selector':'textarea',
	    'menubar':false,
	    'readonly':false,
		'statusbar': false,
	    'plugins': ["advlist autolink lists charmap print preview hr anchor pagebreak spellchecker",
	        "searchreplace wordcount visualblocks visualchars fullscreen insertdatetime  nonbreaking",
	        "save table contextmenu directionality emoticons paste textcolor", "image imagetools", "autoresize colorpicker directionality", "lineheight"],
	    'toolbar': "insertfile undo redo | styleselect fontselect fontsizeselect| bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | l      | print preview fullpage | forecolor backcolor | image | fontsizeselect lineheight",
	    'width':"100%",
		'background-color': "#F5F5F5",
		'font_formats' : "Microsoft Yahei=Microsoft Yahei",
		'fontsize_formats' : "8px 9px 10px 11px 12px 13px 14px 15px 16px 17px 18px 19px 20px 21px 22px 23px 24px",
		setup : function(ed) {
			ed.on('init', function(args) {
			    if (content !== '') {
                    tinymce.get('mainText').getBody().innerHTML = content;
				}
            });
		}
	});
 var app = angular.module('detailApp', []),
    length = location.search.length,
	type = location.search.substring(4, length),
	localMessage,
	wishInLocal,
	wishlistId,
	wishlistDetailId,
	cartDetailId;
app.controller('details', function($scope, $http) {
    $http.get("/wish/list?wishId="+type).success(function(response) {
	    $scope.wish = response[0];
	    wishInLocal = response[0];
	    $http.get("/wish/list?generalCode="+response[0].generalCode).success(function(response) {
	    	if (response.length > 4) {
		        $scope.relevantWishs = response.slice(0, 4);
	    	}
	    	else {
	    		$scope.relevantWishs = response;
	    	}
			unmusk();
		});
	});
	$http.get("/message/list?wishId="+type).success(function(response) {
		localMessage = response[0].messageId;
		if (tinymce.get('mainText') !== null) {
		    tinymce.get('mainText').getBody().innerHTML = response[0].content;
	    }
		else {
		    content = response[0].content;
		}
	});
});
</script>
<script>
    muskCurrentPage();
    function validateInWishList() {
    	$.ajax({
    		url: '/wishlist/list',
    		type: 'GET',
    		contentType: "application/json; charset=UTF-8",
    		success:function(data){
    	        var resultCode =data;
    			if (data.length > 0) {
    	            wishlistId = data[0].wishlistId;
    			}
    		    $.ajax({
    				url: '/wishlistDetail/getAllWishList?wishlistId='+wishlistId,
    				type: 'get',
    				success:function(data){
    					var response = data;
    					for (var i=0;i<response.length;i++) {
    					    if (response[i].wishId === wishInLocal.wishId) {
    					    	$(".addToWishBtn").addClass("disableDiv");
    					    	$(".addToWishBtn")[0].innerText = "已加入愿望单";
    					    	$(".addToWishBtn")[1].innerText = "已加入愿望单";
    					    	wishlistDetailId = response[i].wishDetailId;
    					    }
    					}
    				},
    				error: function(error) {
    					var response = error;
    					//$(".disableDiv").find("p")[0].innerText = "已加入愿望清单";
    				}
    			});
    		},
    		error: function(error) {
    		}
    	});
    }
    function validateInCart() {
    	$.ajax({
    		url: '/shoppingCartController/listCart',
    		type: 'GET',
    		contentType: "application/json; charset=UTF-8",
    		success:function(data){
    	        var resultCode =data;
    	        if (data !== null) {
    			    $.ajax({
    					url: '/wishlistDetail/getAllCartList?cartId='+data.cartId,
    					type: 'get',
    					success:function(data){
    						var response = data;
    						for (var i=0;i<response.length;i++) {
    						    if (response[i].wishId === wishInLocal.wishId) {
    						    	$(".saveToCart").addClass("disableDiv");
    						    	$(".saveToCart")[0].innerText = "已添加购物车";
    						    	$(".saveToCart")[1].innerText = "已添加购物车";
    						    	cartDetailId = response[i].cartDetailId;
    						    }
    						}
    					},
    					error: function(error) {
    						var response = error;
    						//$(".disableDiv").find("p")[0].innerText = "已加入愿望清单";
    					}
    				});
    	        }
    		},
    		error: function(error) {
    		}
    	});
    }
    function addToWishlistAfterCheck(object) {
    	$.ajax({
    		url: '/wishlistDetail/addSingleToWish?wishId='+wishInLocal.wishId,
    		type: 'post',
    		contentType: "application/json; charset=UTF-8",
    		data: [],
    		dataType:'json',
    		success:function(data){
    			$(".addToWishBtn").addClass("disableDiv");
		    	$(".addToWishBtn")[0].innerText = "已加入愿望单";
		    	$(".addToWishBtn")[1].innerText = "已加入愿望单";
		    	wishlistDetailId = data[0].wishlistDetailId;
    			unmusk();
    		},
    		error: function(error) {
    			unmusk();
    		}
    	});
    }
    function removeFromWishlistAfterCheck(object) {
    	$.ajax({
    		url: '/wishlistDetail/removeSingleFromWish?wishlistDetailId='+wishlistDetailId,
    		type: 'delete',
    		contentType: "application/json; charset=UTF-8",
    		dataType:'json',
    		success:function(data){
    			$(".addToWishBtn").removeClass("disableDiv");
		    	$(".addToWishBtn")[0].innerText = "加入愿望单";
		    	$(".addToWishBtn")[1].innerText = "加入愿望单";
    			unmusk();
    		},
    		error: function(error) {
    			unmusk();
    		}
    	});
    }
    function addToCartAfterCheck(object) {
    		$.ajax({
    			url: '/shoppingCartController/addSingleToCart?wishId='+wishInLocal.wishId,
    			type: 'post',
    			contentType: "application/json; charset=UTF-8",
    			data: [],
    			dataType:'json',
    			success:function(data){
    				$(".saveToCart").addClass("disableDiv");
			    	$(".saveToCart")[0].innerText = "已添加购物车";
			    	$(".saveToCart")[1].innerText = "已添加购物车";
    		    	window.frames[0].addCountOfShoppingCart(1);
    		    	cartDetailId = data[0].cartDetailId;
    				unmusk();
    			},
    			error: function(error) {
    				unmusk();
    			}
    		});
    }
    function removeFromCartAfterCheck(object) {
		$.ajax({
			url: '/shoppingCartController/removeSingleFromCart?cartDetailId='+cartDetailId,
			type: 'delete',
			contentType: "application/json; charset=UTF-8",
			dataType:'json',
			success:function(data){
				$(".saveToCart").removeClass("disableDiv");
		    	$(".saveToCart")[0].innerText = "加入购物车";
		    	$(".saveToCart")[1].innerText = "加入购物车";
		    	window.frames[0].addCountOfShoppingCart(-1);
				unmusk();
			},
			error: function(error) {
				unmusk();
			}
		});
    }
    function addToWishlist() {
    	muskCurrentPage();

    	if (wishlistId!== null && wishlistId!== undefined && wishlistId != "") {
    		addToWishlistAfterCheck();
    	}
    	else {
    		window.parent.popupLogInPage();
    		unmusk();
    	}
    }
    function removeFromWishlist() {
    	muskCurrentPage();

    	if (wishlistId!== null && wishlistId!== undefined && wishlistId != "") {
    		removeFromWishlistAfterCheck();
    	}
    	else {
    		window.parent.popupLogInPage();
    		unmusk();
    	}
    }
    function addToCartlist() {
    	muskCurrentPage();

    	if (wishlistId!== null && wishlistId!== undefined && wishlistId != "") {
    		addToCartAfterCheck();
    	}
    	else {
    		window.parent.popupLogInPage();
    		unmusk();
    	}
    }
    function removeFromCartlist() {
    	muskCurrentPage();

    	if (wishlistId!== null && wishlistId!== undefined && wishlistId != "") {
    		removeFromCartAfterCheck();
    	}
    	else {
    		window.parent.popupLogInPage();
    		unmusk();
    	}
    }
    $(".addEmergency").click(function() {
	    if ($("#emergencyContactInfo").is(":hidden")) {
		    $("#emergencyContactInfo").fadeIn();
		}
		else {
		    $("#emergencyContactInfo").fadeOut();
		}
	});
	$(".singleSlide").click(function() {
	    var id = parseInt($(this)[0].id);
		$(".singleSlide").removeClass("selectedPic");
        $(this).addClass("selectedPic");
	    $("#photoShowArea").find("div").css({'opacity': 0});
		$($("#photoShowArea").find("div")[id-1]).css({'opacity': 1});
	});
	$("body").on("click", ".singleReference", function() {
		window.location.href='productDetail3.html?id='+$(this)[0].id;
	});
	$(".goToOtherPlace").click(function() {
		var catas = ["II-JJ","SS","M-S-W","G-H-L-T","VV-O","P-Q-R-U","NN-X-N"];
		for (var i=0; i< catas.length; i++) {
			var cata = catas[i];
			var types = cata.split("-");
			for (var j=0; j< types.length; j++) {
				if (types[j] === wishInLocal.generalCode) {
					window.location.href= "/catagoryProduct.html?cata="+cata;
				}
			}
		}
	});
	$(window).scroll(function(){
		var topPosition = document.body.scrollTop,
		    maxTopPosition = $("#referenceContent")[0].offsetTop;
		if (topPosition > 300 && (maxTopPosition - topPosition > 300)) {
			$("#bottomRight").show();
		}
		else {
			$("#bottomRight").hide();
		}
		
		if (topPosition > 510) {
		    $("#middleContent").addClass("fixDiv");
			$(".singleNavi").addClass("fixSingleNavi");
		}
		else {
		$("#middleContent").removeClass("fixDiv");
		    $(".singleNavi").removeClass("fixSingleNavi");
		}
	});
	$($(".singleNavi")[0]).click(function() {
		if ($(this).hasClass("fixSingleNavi")) {
			$("html,body").animate({scrollTop:$("#bottomLeft").offset().top-8},300);
		}
		else {
		    $("html,body").animate({scrollTop:$("#bottomLeft").offset().top-43},300);
		}
	});
	$($(".singleNavi")[1]).click(function() {
		if ($(this).hasClass("fixSingleNavi")) {
			$("html,body").animate({scrollTop:$("#referenceContent").offset().top-20},300);
		}
		else {
		    $("html,body").animate({scrollTop:$("#referenceContent").offset().top-60},300);
		}
	});
	$($(".singleNavi")[2]).click(function() {
		if ($(this).hasClass("fixSingleNavi")) {
			$("html,body").animate({scrollTop:$("#otherType").offset().top-40},300);
		}
		else {
		    $("html,body").animate({scrollTop:$("#otherType").offset().top-40},300);
		}
	});
	window.onload = function() {
	    $(tinymce.get('mainText').iframeElement).contents().find("body").css({
	        'background-color': '#F5F5F5'
	    });
		validateInWishList();
		validateInCart();
		$(".saveToCart").click(function() {
			if (!$(this).hasClass("disableDiv")){
				addToCartlist();
			}
			else {
				removeFromCartlist();
			}
		});
		$(".addToWishBtn").click(function() {
			if (!$(this).hasClass("disableDiv")){
			    addToWishlist();
			}
			else {
				removeFromWishlist();
			}
		});
	};
</script>
</html>