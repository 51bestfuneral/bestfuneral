<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<title>念念--墓地列表</title>
<link href="/js/images/niannian.ico" rel="shortcut icon" />
<meta name="description" content="念念网致力于打造智能葬礼产品和服务定制工具。念念主张“不要让你爱的人走的太匆忙”，鼓励充分尊重逝者意愿的提前定制，已实现“殡葬服务价格透明化、互联网化、个性化”为己任 。念念，也是中国最大的日系骨灰盒骨灰坛销售公司，最有特色的祭扫祭祀用品服务商。" /> 
<meta name="keywords" content="念念,念念网,葬礼定制,殡葬,上海殡葬,殡葬服务,上海墓地， 骨灰盒，骨灰坛，寿衣，日本骨灰盒，葬礼花费，佛事服务，私人定制，生前契约，葬礼保险,提前定制" /> 
<meta http-equiv="content-type" content="text/html; charset=utf-8" /> 
<meta http-equiv="pragma" content="no-cache" /> 
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-script-type" content="text/javascript" /> 
</head>
<link href="/css/cemeteryList.css" rel="stylesheet">
<script src="../js/jquery-2.1.4.js"></script>
<script src="../js/jquery-ui.js"></script>
<script src="../js/sliderx.js"></script>
<script src="../js/angular-1.4.0-rc.2/angular.js"></script>
<link href="../js/bootstrap-3.3.6-dist/css/bootstrap.css" rel="stylesheet">
<script src="../js/bootstrap-3.3.6-dist/js/bootstrap.js"></script>
<link href="/js/personal.css" rel="stylesheet">
<script src="/js/generalUsage.js"></script>
<script src="../js/timepicker/js/moment-with-locales.js"></script>
<script src="../js/timepicker/js/bootstrap-datetimepicker.js"></script>
<body ng-app="myApp" ng-controller="cemetery">
<div class="topBarDiv">
<IFRAME NAME="content_frame" width=100% SRC="component/topBar.html?cat=cemetery" frameborder = 0 height = "67px"></IFRAME>
</div>
<div class="container" ng-cloak>
<div id="mainHeader">
    <div id="headerText">
        <h1>我们和上海多家墓园和寺庙建立了合作，为您提供方便</h1>
	</div>
	<div id="navigateVisit">
		<input type="text" placeholder="选择墓地/寺庙" id="inputArea">
		</input>
		<div class='input-group date' id='datetimepicker1'>
			<input type='text' class="form-control mandantory" placeholder="选择预约时间" ng-model="user.birthday" id="requestDate"/>
            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
            </span>
		</div>
		<button id="visitButton">
			<p>在线预约</p>
		</button>
        <div id="searchBlurDiv" hidden>
            <div class="stateBar" ng-repeat="result in resultMap">
                <div class="headerCol">
                    <span><b ng-bind="result.district"></b></span>
                </div>
                <div class="normalCol">
                    <div class="normalCell" ng-repeat="cemetery in result.list track by $index">
                        <span ng-bind="cemetery.cemeteryName"></span>
                    </div>
                </div>
            </div>
            <div class="subBar">
                <span>温馨提示，选择墓地或者寺庙，也可以直接输入</span>
            </div>
        </div>
		<div id="typeBlurDiv" hidden>
            <div class="optionBar" ng-repeat = "search in searchList">
				<div class="optionIcon">
					<img src="../js/images/cemeteryList.png"/>
				</div>
				<div class="optionDesc">
                    <span class="descMain" ng-bind="search.cemeteryName"></span>
					<span class="descAdd" ng-bind="search.address"></span>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="cemeteryList">
    <div class="listTitle">
	    <img src="../js/images/cemeteryList.png"></img>
		<h1>墓园</h1>
	</div>
	<div class="listContent">
	    <div  ng-click="gotoCemetery(bean.cemeteryId)" id={{bean.cemeteryId}} class={{bean.css}}  ng-repeat=" bean in  cemeteryBeans"> 
		 <img  src={{bean.descImgUrl}}  alt="念念,念念网,葬礼定制,殡葬,上海殡葬,殡葬服务,上海墓地， 骨灰盒，骨灰坛，寿衣，日本骨灰盒，葬礼花费，佛事服务，私人定制，生前契约，葬礼保险,提前定制"></img>
		  <div class="ceMuskDiv"></div>
		  <span style="position: relative; top: -100; left: 0; background-color:#ffffff;"><h1>{{bean.cemeteryName}}</h1></span> 
		  <span style="position: relative; top: -100; left: 0; background-color:#ffffff;"><h5>{{bean.district}}</h5></span>
		</div>
	</div>
	<div class="listTitle">
	    <img src="../js/images/cemeteryList.png"/>
		<h1>寺庙</h1>
	</div>
	<div class="listContent">
	    <div  ng-click="gotoTemple(bean.cemeteryId)" id={{bean.cemeteryId}} class={{bean.css}}  ng-repeat=" bean in  temples" on-finish-render-filters>
		 <img  src={{bean.descImgUrl}}  alt="念念,念念网,葬礼定制,殡葬,上海殡葬,殡葬服务,上海墓地， 骨灰盒，骨灰坛，寿衣，日本骨灰盒，葬礼花费，佛事服务，私人定制，生前契约，葬礼保险,提前定制"></img>
		 <div class="ceMuskDiv"></div>
		 <span style="position: relative; top: -100; left: 0; background-color:#ffffff;"><h1>{{bean.cemeteryName}}</h1></span>
		 <span style="position: relative; top: -100; left: 0; background-color:#ffffff;"><h5>{{bean.district}}</h5></span> 
		</div>
    </div>
</div>
<IFRAME NAME="content_frame" width=100% height=246 marginwidth=0 marginheight=0 SRC="component/bottomBar.html" frameborder = 0></IFRAME>
</body>
<script type="text/javascript">
	var app = angular.module('myApp', []),
	    cemeteryListBean;
	app.directive('onFinishRenderFilters', function ($timeout) {
	    return {
	        restrict: 'A',
	        link: function(scope, element, attr) {
	            if (scope.$last === true) {
	                $timeout(function() {
	                    scope.$emit('ngRepeatFinished');
	                });
	            }
	        }
	    };
	});
	app.controller('cemetery', function($scope, $http) {
		muskCurrentPage();
        var searchList = [];
	 	$http.get("/cemetery/list").success(function(response) {
			var resultMap = [];
			for (var p in response) {
				var result = {};
				result.district = p.replace('上海市','');
				result.list = response[p];
				resultMap.push(result);
                for (var i=0;i < response[p].length;i++) {
                    searchList.push(response[p][i]);
                }
			}
			$scope.resultMap = resultMap;
            unmusk();
        });
        $("#inputArea").bind('input propertychange', function() {
            $scope.searchList = [];
            for (var i=0;i < searchList.length;i++) {
                if ($(this)[0].value !== "") {
                    var hasValue = false;
                    $("#searchBlurDiv").fadeOut();
                    if (searchList[i].cemeteryName.indexOf($(this)[0].value) >= 0
                            || searchList[i].address.indexOf($(this)[0].value) >= 0) {
                        $scope.searchList.push(searchList[i]);
                        hasValue = true;
                    }
                    if (hasValue) {
                        $scope.$apply();
                        $("#typeBlurDiv").fadeIn();
                    }
                }
                else {
                    $("#typeBlurDiv").fadeOut();
                    $("#searchBlurDiv").fadeIn();
                }
            }
        });
	 	$scope.gotoCemetery = function(id){
	 	    window.location.href='cemetery.html?id='+id;
	 	} 	
 	
        $scope.gotoTemple= function(id){		
		    window.location.href='temple.html?id='+id;
		}
        $scope.$on('ngRepeatFinished', function (ngRepeatFinishedEvent) {
        	$(".cemeteryDiv").hover(function() {
        		$(this).find(".ceMuskDiv").css({
        			opacity: 0.1
        		});
        	}, function() {
        		$(this).find(".ceMuskDiv").css({
        			opacity: 0.6
        		});
        	});
        });
	});
</script>
<script>
	$('#datetimepicker1').datetimepicker({
		format: "YYYY-MM-DD",
		locale: "zh-cn"
	});
	$("#visitButton").click(function() {
		popupRequestPage();
	});
    $("#inputArea").focus(function() {
        if ($("#inputArea")[0].value === '') {
            $("#searchBlurDiv").fadeIn();
        }
    });
    $("#typeBlurDiv").on("click", ".optionBar", function() {
        $("#inputArea")[0].value = $(this).find(".descMain")[0].innerText;
        $("#typeBlurDiv").fadeOut();
    });
    $("#searchBlurDiv").on("click", ".normalCell", function(e) {
        $("#inputArea")[0].value = $(this).find("span")[0].innerText;
        $("#searchBlurDiv").fadeOut();
        e.stopPropagation();
    });
    $(document).click(function(e){
        if (e.toElement.offsetParent !== $("#searchBlurDiv")[0]
            && e.toElement !== $("#inputArea")[0]) {
            $("#searchBlurDiv").fadeOut();
        }
    });
</script>
</html>