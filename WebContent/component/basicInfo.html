<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head id="head">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<title>
葬礼定制
</title>
</head>
<script src="/js/jquery-2.1.4.js"></script>
<script src="/js/jquery-ui.js"></script>
<script src="/js/angular-1.4.0-rc.2/angular.js"></script>
<script src="/js/bootstrap-3.3.6-dist/js/bootstrap.js"></script>
<link href="/js/bootstrap-3.3.6-dist/css/bootstrap.css" rel="stylesheet">
<link href="/js/timepicker/css/bootstrap-datetimepicker.css" rel="stylesheet">
<script src="/js/timepicker/js/moment-with-locales.js"></script>
<script src="/js/timepicker/js/bootstrap-datetimepicker.js"></script>
<script src="/js/idCheck.js"></script>
<style>
    body {
	    text-align: center;
	}
    #productMain {
		overflow: hidden;
	}
    #tabCarousel {
	    width: 100%;
		height: 50px;
		border-bottom: 1px solid #e7e7e7
	}
    .productTab {
	    width: 120px;
		height: 50px;
		float: left;
		transition:background 0.2s;
		-moz-transition:background 0.2s;
        -webkit-transition:background 0.2s;
        -o-transition:background 0.2s;
	}
	.productTab:hover {
	    background-color: #B5AFAF;
	}
	.productTab p {
	    font-size: 20px;
		line-height: 50px;
		cursor: pointer;
		color: #707070;
	}
	.carousel-control {
	    width: 15px;
		background-image: none !important;
	}
	.headerArrow {
	    margin-top: 8px;
	}
	.index {
	    width:54px;
		height: 54px;
		border-radius: 27px;
		background-color: #f6f6f6;
		margin: 0 auto;
		margin-top: 28px;
	}
	.index p {
	    line-height: 54px;
		color: #707070;
		margin: 0px;
	}
	.questionCenter {
		overflow: auto;
		text-align: center;
		padding-bottom: 143px;
	}
	.questionCenter h1{
	    font-size: 38px;
		color: #707070;
		margin: 0px;
	}
	.questionArea {
	    text-align: center;
		width: 100%;
		padding-top: 90px;
	}
	.questionArea span {
	    font-size: 23px;
        color: #707070;
		font-family: "Microsoft Yahei";
	}
	.questionArea select {
	    color: #ff5274;
		font-size: 23px;
		font-family: "Microsoft Yahei";
		width: 120px;
		height: 30px;
		display: inline;
		padding: 0px;
	}
	.questionText {
		text-align: center;
		width: 522px;
		margin: 0px auto;
		margin-top: 10px;
		margin-bottom: 10px;
	}
	#rightFooter {
		width: 100%;
		overflow: auto;
		background: #fafafa;
		padding-top: 31px;
		padding-bottom: 31px;
		padding-left: 55px;
		padding-right: 55px;
	}
	#prevStep {
		float: left;
		width: 150px;
		height: 60px;
	}
	#nextStep {
		float: right;
		width: 144px;
		height: 60px;
	}
	.operatorButton {
		background: #d6d6d6;
		border-radius: 4px;
		box-shadow: 0 4px 0px 0 #c5c5c5;
		text-align: center;
		cursor: pointer;
	}
	.operatorButton:hover {
		background: #ff5274;
		box-shadow: 0 4px 0px 0 #e6385a;
	}
	.operatorButton p {
		margin: 0px;
		line-height: 60px;
		color: #ffffff;
		font-size: 24px;
	}
	.disabled {
	    opacity: 0.5;
		cursor: default;
		background: #d6d6d6!important;
		box-shadow: 0 4px 0px 0 #c5c5c5!important;
	}
	#moveCursor {
	    width: 120px;
		height: 2px;
		position: absolute;
		background: #ff5274;
	}
	.selected {
	    border: 2px solid #ff5274!important;
	}
	.finishedIcon {
	    width: 16px;
		height: 16px;
		background: #2c9676;
		text-align: center;
		position: absolute;
		border-radius: 8px;
		top: 10px;
		margin-left: 100px;
	}
	.finishedIcon span {
	    color: #ffffff;
		font-size: 6px;
		line-height: 16px;
	}
	
	.inputStyle{
		border-top:none;
		border-left:none;
		border-right:none;
		border-bottom:1px solid   #979797;
		height:40px;
		outline:none;		
		padding-right:0px;
		font-weight:100;
		color:#707070; 
		font-family: STHeitiSC-Medium;
		font-size:40px;
	}
	.subQuestionArea {
	    text-align: center;
		width: 310px;
		margin: 0px auto;
	}
	.subQuestionArea span {
	    font-size: 23px;
        color: #707070;
		font-family: "Microsoft Yahei";
	}
	.subQuestionArea select {
	    color: #ff5274;
		font-size: 23px;
		font-family: "Microsoft Yahei";
		width: 120px;
		height: 30px;
		display: inline;
		padding: 0px;
		margin-bottom: 10px;
	}
	.inputQuestionArea {
	    width: 700px;
		text-align: center;
		margin: 0px auto;
		padding-top: 90px;
	}
	.spanCoat span {
	    font-size: 23px;
        color: #707070;
		font-family: "Microsoft Yahei";
		width: 100px;
	}
	.singleQuestion {
	    float: left;
		overflow: auto;
		margin-left: 20px;
		padding-right: 20px;
	}
	.warningMsg {
	    width: 100%;
	    height: 25px;
	    color: red;
	    text-align: left;
	}
    .spanCoat {
	    float: left;
		width: 110px;
		text-align: left;
	}
	.form-control {
	    float: left;
		width: 200px;
		font-family: "Microsoft Yahei";
		margin-bottom: 5px;
		border: none;
		box-shadow: none;
		border-bottom: 1px solid #ccc;
	}
	#datetimepicker1 {
	    width: 200px;
		height: 26px;
		padding: 0px;
		float: left;
		margin-top: 25px;
	}
	.input-group-addon {
	    border: none;
	    border-bottom: 1px solid #ccc;
	    background: #ffffff;
	}
	.longField {
	    width: 400px;
	}
	#questionContent {
	    width: 600px;
	    margin: 0px auto;
	    overflow: auto;
	}
	#questionContent div {
	    float: left;
	}
	.subQuestionArea div {
	    float: left;
	}
	.errorMsgLine {
	    width: 100%;
	    height: 30px;
	}
	.subQuestionCoat {
	    width: 100%;
	}
	.errorMsgLine span {
	    font-size: 8px;
	    color: red;
	}
	#singleMsgAge {
	    padding-left: 82px;
	}
	#singleMsgWork {
	    padding-left:260px;
	}
	#singleMsgDistrict {
	    padding-left: 470px;
	}
	#singleMsgWho {
	    padding-left: 95px;
	}
</style>
<script type="text/javascript">
var app = angular.module('productApp', []);
var user;
function validateInput(tab) {
	var emailFilter  = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/,
        phoneFilter = /(^[0-9]{3,4}\-[0-9]{3,8}$)|(^[0-9]{3,8}$)|(^\([0-9]{3,4}\)[0-9]{3,8}$)|(^0{0,1}13[0-9]{9}$)/,
        checkFailed = true;
	handleFinished(tab);
	if (tab[0].id === "1-content") {
		tab.find(".mandantory").each(function() {
			var me = $(this),
			    id = me[0].id,
			    msgFiled = $("#singleMsg"+id);

			if (me[0].value === "" || me[0].value.length > 10) {
				me[0].focus();
				msgFiled.find("span").fadeIn();
				checkFailed = false;
				return false;
			}
			else {
				msgFiled.find("span").hide();
			}
		});
	}
	else {
		tab.find(".mandantory").each(function() {
			var me = $(this),
			    msgFiled = me.closest('.singleQuestion').find(".warningMsg");

			if (msgFiled.length === 0 && me.closest('#datetimepicker1').length > 0) {
				msgFiled = $("#datetimepicker1Msg");
			}
			if (me[0].value === "") {
				me[0].focus();
				msgFiled[0].innerText = "请填写这个字段";
				checkFailed = false;
				return false;
			}
			else {
				 msgFiled[0].innerText = "";
			}
		});
	}
	if (!checkFailed) {
		return false;
	}
	tab.find(".mailField").each(function() {
		var me = $(this),
		    msgFiled = me.closest('.singleQuestion').find(".warningMsg");

		if (me[0].value !== "" && !emailFilter.test(me[0].value)) {
			me[0].focus();
			msgFiled[0].innerText = "Format Error";
			checkFailed = false;
			return false;
		}
	});
	if (!checkFailed) {
		return false;
	}
	tab.find(".phoneField").each(function() {
		var me = $(this),
		    msgFiled = me.closest('.singleQuestion').find(".warningMsg");

		if (me[0].value !== "" && !phoneFilter.test(me[0].value)) {
			me[0].focus();
			msgFiled[0].innerText = "电话号码格式不正确";
			checkFailed = false;
			return false;
		}
	});
	var identifyNumberFiled = tab.find("#identifyNumber"),
	    identifyNumber;

	if (identifyNumberFiled.length > 0) {
		identifyNumber = identifyNumberFiled[0].value;
	    if (!nunber(identifyNumber)) {
	    	checkFailed = false;
	    	return false;
	    }
	}
	return true;
}
app.controller('products', function($scope, $http) {
    var ages = [];

    $http.get("/user/list").success(function(response) {
    	if (response.forSelf === 0) {
    		response.forSelf = "我爱的人";
    	}
    	else {
    		response.forSelf = "我自己";
    	}
    	if (response.gender === 2) {
    		response.gender = "女";
    	}
    	else {
    		response.gender = "男";
    	}
    	$scope.user = response;
    });
	$(document.body).on("click",".operatorButton", function( event ) {
		var me = $(this),
		    count =  $(".questionCenter").length,
		    contentId = $(".cursored")[0].id + "-content",
		    center = $("#"+contentId);

		if (me.hasClass("disabled")) {
		    return;
		}
		if (me[0].id === "nextStep") {
        if (validateInput(center)) {
        	if (center.next().hasClass("questionCenter")) {
        		center.hide();
        		center.next().fadeIn();
        		handleCursor($(".cursored").next());
        		if (!center.next().next().hasClass("questionCenter")) {
        			$("#nextStep").find("p")[0].innerText = "保存";
        		}
        		else {
        			$("#nextStep").find("p")[0].innerText = "下一步";
        		}
        		window.parent.iFrameHeight(0);
        	}
        	else {
    			var user = $scope.user,
			    	users = [];
    			window.parent.muskCurrentPage();
    			user.birthday = $("#datetimepicker1").find("input")[0].value;
				if (user.gender === "女") {
					user.gender = 2;
				}
				else {
					user.gender = 1;
				}

				if (user.forSelf === "我自己") {
					user.forSelf = 1;
				}
				else {
					user.forSelf = 0;
				}
				users.push(user);
 		    	$.ajax({
			    	url: '/user/edit',
					type: 'POST',
					contentType: "application/json; charset=UTF-8",
					dataType: 'json',
					data: JSON.stringify(user),
					success:function(data){
						if (data === 1) {
		                	window.location.reload();
		        		}
		        		else {
		        			window.parent.nextTab();
		        		}
			    	},
				    error: function(error) {
					    alert(error);
				    }
			    });
        	}
        }
		}
		else {
			window.parent.location.href='/designProposal.html';;
		}
	});
});
</script>
<body ng-app="productApp" ng-controller="products" onselectstart="return false">
<div id="productMain"  ng-cloak>
<div id="tabCarousel" class="carousel slide">
<div class="carousel-inner">
    <div class="item active" alt="First slide">
		<div class="productTab" id="1">
		    <p>基本信息</p>
			<div class="finishedIcon" hidden><span>&#10004;</span></div>
		</div>
		<div class="productTab" id="2">
		    <p>个人信息</p>
			<div class="finishedIcon" hidden><span>&#10004;</span></div>
		</div>
		<div class="productTab" id="3">
		    <p>联系人信息</p>
			<div class="finishedIcon" hidden><span>&#10004;</span></div>
		</div>
    </div>
</div>
<a class="carousel-control left" href="#tabCarousel" 
    data-slide="prev"><p class="headerArrow">&lsaquo;</p></a>
<a class="carousel-control right" href="#tabCarousel" 
    data-slide="next"><p class="headerArrow">&rsaquo;</p></a>
</div>
<div id="moveCursor">
</div>
<div class="questionCenter" hidden id="1-content">
    <div class="index">
	    <p><b>1</b>/3</p>
	</div>
	<div class="questionText">
	    <h1>轻轻地，你来了...</h1>
	</div>
	<div class="questionArea">
		<div id="questionContent">
		    <div class="inputTitle">
			    <span>我今年</span>
			</div>
			<div class="singleQuestion">
			    <input id="Age" ng-model="user.age" class="mandantory" type="text" style="color:#ff5274; height:31px;width:50px;text-align:center;vtical-align:middle; font-family: Microsoft Yahei;  font-size: 23px; border: none;border-bottom:1px solid #000000; -webkit-appearance: none; outline:none;" maxlength='3'" autofocus="autofocus" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') ">
			    </input>
			</div>
			<div class="inputTitle">
			    <span>岁，现在</span>
			</div>
			<div>
				<select id="Work" ng-model="user.work" class="mandantory" style="border: none;border-bottom:1px solid #000000; -webkit-appearance: none; outline:none; text-align:center; padding-left: 18px;">
					<option value="0">已退休</option>
					<option value="1">待业</option>
					<option value="2">在职</option>
				</select>
			</div>
			<div class="inputTitle">
			    <span>家住上海</span>
			</div>
			<div>
				<select id="District" ng-model="user.district" class="mandantory" ng-model="user.district" style="border: none;border-bottom:1px solid #000000; -webkit-appearance: none; outline:none; text-align:center; padding-left: 16px;">
					<option default>长宁区</option>
					<option>黄浦区</option>
					<option>静安区</option>
					<option>杨浦区</option>
					<option>宝山区</option>
					<option>浦东新区</option>
					<option>闸北区</option>
					<option>普陀区</option>
					<option>青浦区</option>
					<option>虹口区</option>
					<option>徐汇区</option>
					<option>金山区</option>
					<option>奉贤区</option>
					<option>松江区</option>
					<option>闵行区</option>
					<option>嘉定区</option>
				</select>
			</div>
			<div class="errorMsgLine">
			    <div id="singleMsgAge" class="singleMsgUnder">
			        <span hidden>请输入年龄</span>
			    </div>
			    <div id="singleMsgWork" class="singleMsgUnder">
			        <span hidden>请输入工作状态</span>
			    </div>
			    <div id="singleMsgDistrict" class="singleMsgUnder">
			        <span hidden>请输入区</span>
			    </div>
			</div>
		</div>
	</div>
	<div class="subQuestionArea">
		<div class="subQuestionCoat">
		    <div class="inputTitle">
		    <span>我是为了</span>
		    </div>
		    <div>
		    <select id="Who" ng-model="user.forSelf" class="mandantory" style="border: none;border-bottom:1px solid #000000; -webkit-appearance: none; outline:none; text-align:center; padding-left: 18px;">
				<option default>我自己</option>
				<option>我爱的人</option>
			</select>
			</div>
			<div class="inputTitle">
			<span>定制葬礼</span>
			</div>
		</div>
		<div class="errorMsgLine">
		    <div id="singleMsgWho" class="singleMsgUnder">
		        <span hidden>请输入为谁定制</span>
		    </div>
		</div>
	</div>
</div>
<div class="questionCenter" hidden id="2-content">
    <div class="index">
	    <p><b>2</b>/3</p>
	</div>
	<div class="questionText">
	    <h1>我们希望知道该如何不忘记你...</h1>
	</div>
	<div class="inputQuestionArea">
	    <div class="singleQuestion">
	        <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>姓名*</span></div>
			<input type="text" class="form-control mandantory" ng-model="user.name" onkeyup="value=value.replace(/[0-9]+/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[0-9]+/g,''))"></input>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>性别*</span></div>
			<select type="text" class="form-control mandantory" ng-model="user.gender">
			    <option default></option>
			    <option>男</option>
			    <option>女</option>
			</select>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg" id="datetimepicker1Msg"><span></span></div>
			<div class="spanCoat"><span>出生日期*</span></div>
		</div>
		<div class='input-group date' id='datetimepicker1'>
		        <input type='text' class="form-control mandantory" ng-model="user.birthday"/>
		        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span>
		        </span>
	    </div>
		<div class="singleQuestion">
		    <div class="warningMsg" id="identifyNumberWarn"><span></span></div>
			<div class="spanCoat"><span>身份证号</span></div>
			<input type="text" class="form-control" ng-model="user.identifier" id="identifyNumber"></input>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>联系电话*</span></div>
			<input type="text" class="form-control mandantory phoneField" ng-model="user.phone" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') "></input>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>电子邮箱</span></div>
			<input type="text" class="form-control mailField" ng-model="user.email"></input>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>地址</span></div>
			<input type="text" class="form-control longField" ng-model="user.address"></input>
		</div>
	</div>
</div>
<div class="questionCenter" hidden id="3-content">
    <div class="index">
	    <p><b>3</b>/3</p>
	</div>
	<div class="questionText">
	    <h1>你的心里只有他没有其他...</h1>
	</div>
	<div class="inputQuestionArea">
	    <div class="singleQuestion">
	        <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>姓名*</span></div>
			<input type="text" class="form-control mandantory" ng-model="user.contactor" onkeyup="value=value.replace(/[0-9]+/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[0-9]+/g,''))"></input>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>电话*</span></div>
			<input type="text" class="form-control mandantory phoneField" ng-model="user.contactorPhone" onkeyup="this.value=this.value.replace(/[^\d]/g,'') " onafterpaste="this.value=this.value.replace(/[^\d]/g,'') "></input>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>电子邮件</span></div>
			<input type="text" class="form-control mailField" ng-model="user.contactorMail"></input>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>地址</span></div>
			<input type="text" class="form-control" ng-model="user.contactorAddress"></input>
		</div>
		<div class="singleQuestion">
		    <div class="warningMsg"><span></span></div>
			<div class="spanCoat"><span>关系*</span></div>
			<input type="text" class="form-control mandantory" ng-model="user.contactorRelate"></input>
		</div>
	</div>
</div>
<div id="rightFooter">
    <div id="prevStep" class="operatorButton">
        <p>重新选择方案</p>
	</div>
	<div id="nextStep" class="operatorButton">
		<p>下一步</p>
	</div>
</div>
</div>
</body>
<script>
function handleFinishButton() {
    var allFinished = true;

    $(".mandantory").each(function() {
		if ($(this)[0].value === "") {
			allFinished = false;
			return false;
		}
	});

	if (allFinished) {
		$("#nextStep").removeClass("disabled");
	}
    else {
		$("#nextStep").addClass("disabled");
    }
}
function handleCursor(tab) {
    var me = tab;
	$(".productTab").removeClass("cursored");
	me.addClass("cursored");
	$("#moveCursor").animate({left:tab.position().left+'px'});
}
function handleFinished(tabPage) {
    var count = $(".productTab").length,
        tabs;
    
    if (tabPage != null &&tabPage!= undefined) {
    	tabs = tabPage;
    	if (tabPage[0] === $(".questionCenter")[count-1]) {
    	    handleFinishButton();
    	}
    }
    else {
    	tabs = $(".productTab")
    }
    tabs.each(function() {
	    var me = $(this),
		    mustFields = me.find(".mandantory"),
		    finished = true,
		    id = me[0].id.replace('-content', '');
	    if (mustFields.length === 0) {
	    	finished = false;
	    }
		mustFields.each(function() {
			if ($(this)[0].value === "" || $(this)[0].value.length > 20) {
				finished = false;
				return false;
			}
		});
		if (finished) {
			$("#"+id).find(".finishedIcon").fadeIn();
			$("#"+id).addClass("finished");
		}
		else {
			$("#"+id).find(".finishedIcon").fadeOut();
			$("#"+id).removeClass("finished");
		}
	});
}
$(document.body).on("click",".productTab", function( event ) {
	var contentId = $(this)[0].id + "-content",
	    cursoredContentId = $(".cursored")[0].id + "-content",
	    count = $(".productTab").length;
	if (!validateInput($("#"+cursoredContentId))) {
		return false;
	}
	handleCursor($(this));
	if (!$(this).next().hasClass("productTab")) {
		$("#nextStep").find("p")[0].innerText = "完成";
	}
	else {
		$("#nextStep").find("p")[0].innerText = "下一步";
	}
	$(".questionCenter").each(function(){
	    var me = $(this);
		
		if (me[0].id === contentId) {
		    if (me.is(':hidden')) {
		        me.fadeIn();
			}
			else {
			    return false;
			}
		}
		else if (me[0].id !== contentId && !me.is(':hidden')) {
		    me.hide();
		}
	});

	if ($(this)[0] === $(".productTab")[count-1]) {
	    handleFinishButton();
	}
	else {
	    $("#nextStep").removeClass("disabled");
	}
	window.parent.iFrameHeight(0);
});
$(document.body).on("blur",".mandantory", function( event ) {
    var tabPage = $(this).closest(".questionCenter");
	var me = $(this),
			    id = me[0].id,
			    msgFiled = $("#singleMsg"+id);
	if (me[0].value !== "" && me[0].value.length < 10) {
	    msgFiled.find("span").hide();
	}
	handleFinished(tabPage);
});
$("#identifyNumber").on("blur", function( event ) {
    var identifyNumber =$(this)[0].value,
        msgFiled = $(this).closest('.singleQuestion').find(".warningMsg");

    if (!nunber(identifyNumber)) {
    	
    }
});
window.onload=function(){
	$('#datetimepicker1').datetimepicker({
	    format: "YYYY-MM-DD",
	    locale: "zh-cn",
	    viewMode: 'years'
	});
    $(".questionCenter").first().fadeIn();
    $(".productTab").first().addClass("cursored");
	window.parent.iFrameHeight(0);
};
</script>
</html>