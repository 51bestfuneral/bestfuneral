<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head id="head"><title>
    购物车
</title>
<meta name="description" content="念念网致力于打造智能葬礼产品和服务定制工具。念念主张“不要让你爱的人走的太匆忙”，鼓励充分尊重逝者意愿的提前定制，已实现“殡葬服务价格透明化、互联网化、个性化”为己任 。念念，也是中国最大的日系骨灰盒骨灰坛销售公司，最有特色的祭扫祭祀用品服务商。" /> 
<meta name="keywords" content="念念,念念网,葬礼定制,殡葬,上海殡葬,殡葬服务,上海墓地， 骨灰盒，骨灰坛，寿衣，日本骨灰盒，葬礼花费，佛事服务，私人定制，生前契约，葬礼保险,提前定制" />	 						
<meta http-equiv="content-type" content="text/html; charset=utf-8" /> 
<meta http-equiv="pragma" content="no-cache" /> 
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-script-type" content="text/javascript" /> 
<script src="/js/jquery-2.1.4.js"></script>
<script src="/js/jquery-ui.js"></script>
<script src="/js/sliderx.js"></script>
<script src="/js/angular-1.4.0-rc.2/angular.js"></script>
<link href="/js/bootstrap-3.3.6-dist/css/bootstrap.css" rel="stylesheet">
<script src="/js/bootstrap-3.3.6-dist/js/bootstrap.js"></script>
<link href="/component/css/secondLevelMenu.css" rel="stylesheet">
<script src="/js/generalUsage.js"></script>
</head>
<header>
</header>
<style>
.topBarDiv {
    box-shadow: 0px 2px 4px 0px rgba(162, 162, 162, 0.5);
	height: 65px;
	z-index: 100;
}
@media (min-width: 900px) {
  .container {
    width: 100%;
	padding: 0px;
	min-width: 1000px;
  }
}
.container {
    background: #F7F7F7;
}
#decorContainer {
    width: 1040px;
	margin: 0px auto;
	overflow: auto;
}
#tableHeader {
    width: 100%;
	overflow: auto;
}
#headerLeft {
    float: left;
	overflow: auto;
	text-align: left;
}
#headerLeft h1 {
    font-size: 32px;
	line-height: 95px;
	color: #3d3d3d;
	margin: 0px;
}
#headerRight {
    float: right;
	overflow: auto;
}
.rightImg {
    overflow: auto;
	float: right;
	height: 100%;
	margin-left: 10px;
}
.fakeImg {
	height: 95px;
}
.realImg {
    vertical-align: middle;
}
#shopTable {
    width: 100%;
	overflow: auto;
	padding-bottom: 22px;
	background: #ffffff;
}
#tableHeader {
    width: 100%;
	overflow: auto;
	background: #f2f2f2;
	box-shadow: 0px 2px 4px 0px rgba(162, 162, 162, 0.5);
}
#tableHeader div {
    float: left;
	text-align: center;
	height: 55px;
}
.tableContent {
    width: 100%;
	margin-top: 22px;
	overflow: auto;
}
.tableContent div {
	text-align: center;
	float: left;
}
.checkBox {
    width: 58px;
}
#tableHeader .checkBox input {
	margin-top: 22px;
}
.tableContent .checkBox input {
	margin:auto;
	margin-top: 32px;
}
.itemName {
    width: 422px;
	text-align: left!important;
}
.itemPrice {
    width: 140px;
}
.itemAmout {
    width: 140px;
}
.totalPrice {
    width: 140px;
}
.operation {
    width: 140px;
}
.operation span {
    color: #a6a6a6;
	font-size: 20px;
	cursor: pointer;
}
.title {
    font-size: 16px;
	color: #5b5b5b;
	margin: 0px;
	font-weight: bold;
}
.subTitle {
    font-size: 12px;
	color: #1c3653;
	line-height: 20px;
	margin: 0px;
}
#tableHeader .title {
    line-height: 55px;
}
.itemImg {
    width: 78px;
	height: 78px;
	background: #d8d8d8;
	cursor: pointer;
}
.itemImg:hover {
    border: 0px solid #ff5274;
}

.itemImg img{
	  width: 78px;
	height: 78px;
	}
.inputContent {
    padding-top: 14px;
}
.itemDesc {
    text-align: left!important;
	padding-left: 18px;
}
.itemDesc .title {
    cursor: pointer;
}
.itemDesc .title:hover {
    color: red;
}
#shopSumm {
    padding-left: 59px;
	padding-right: 71px;
	padding-bottom: 39px;
	padding-top: 24px;
	overflow: auto;
	background: #f2f2f2;
}
#leftSumm {
    float: left;
	width: 100%;
	margin-top: 15px;
}
.continue {
    overflow: auto;
	float: left;
}
.continue button {
    border: 1px solid #d7d7d7;
	background: #fff;
	color: #ff5274;
	border-radius: 4px;
	margin: 0px;
	font-size: 18px;
	width: 142px;
	height: 44px;
	font-family: "Microsoft Yahei";
}
#rightSumm {
    float: right;
	overflow: auto;
	width: 100%;
}
#rigthTop {
    overflow: auto;
	width: 100%;
}
#rigthTop div {
    float: right;
	text-align: right;
}
#rigthBottom {
    overflow: auto;
	text-align: right;
}
.next {
    overflow: auto;
    float: right;
}
.next button {
    width: 178px;
	height: 44px;
	border-radius: 4px;
	background: #ff5274;
	color: #ffffff;
	font-size: 18px;
	border: none;
	float: right;
	font-family: "Microsoft Yahei";
}
.next button:hover {
    background: #ff496d;
}
.summTitle {
    font-size: 20px;
	color: #5b5b5b;
	font-weight: bold;
	margin: 0px;
}
.titleNumber {
    color: #ff5274;
	padding-top: 0.4px;
}


.titleNumbere {
    color: #ff5274;
	padding-top: 0.4px;
}

.titleNumber {
    color: #ff5274;
	padding-top: 0.4px;
}

#rigthTopContent {
    padding-right: 18px;
}
.oneThird {
    width: 33.33%;
	height: 100%;
    float: left;
}
.changeButton {
    background: #ccc;
	width: 20px;
	height: 20px!important;
	border-radius: 10px;
	cursor: pointer;
}
.changeButton:hover {
    opacity: 0.6;
}
.minusBitton {
    float: right!important;
}
.coverDiv {
    height: auto;
	width: 100%;
	top: 30px;
	bottom: 60px;
	text-align: center;
	position: fixed;
	z-index: 1001;
}
.coverDiv .detailFrame {
    height: 100%;
}
.closeCoverDiv {
	position: absolute;
	top: 0px;
	width: 35px;
	height: 35px;
	border-radius: 17px;
	border: 2px solid #979797;
	color: #979797;
	font-size: 30px;
	text-align: center;
	line-height: 35px;
	cursor: pointer;
}
.closeCoverDiv:hover {
	color: yellow;
	border: 2px solid yellow;
}
.coverImageDiv {
    height: auto;
	width: 100%;
	top: 30px;
	bottom: 60px;
	text-align: center;
	position: fixed;
	z-index: 1001;
}
#noAnyProduct{
	text-align:center;
	}

#noAnyProduct h1 {
    line-height: 200px;
	margin:0px;
	

}
#goShoppingButton {
    width: 220px;
	height: 70px;
	background: #ff5274;
	border-radius: 5px;
	text-align: center;
	margin-top: -50px;
	cursor:pointer;
	opacity: 0.8;
	position:relative;
	left:40%;
}
#goShoppingButton:hover {
    opacity: 1;
}
#goShoppingButton h2 {
    line-height: 70px;
	margin: 0px;
	color: #ffffff;
}
</style>
<script type="text/javascript">
var app = angular.module('productApp', []);
app.directive('onFinishRenderFilters', function ($timeout) {
    return {
        restrict: 'A',
        link: function(scope, element, attr) {
            if (scope.$last === true) {
                $timeout(function() {
                    scope.$emit('ngRepeatFinished');
                });
            }
        }
    };
});
app.controller('product', function($scope, $http) {
	$scope.shappingCart;
	$scope.wishList;
	$scope.$on('ngRepeatFinished', function (ngRepeatFinishedEvent) {
		$(".itemDesc").find(".title").click(function() {
			window.location.href = "/productDetail3.html?id="+$(this)[0].id;
	    });
	});
	  $http.get("/shoppingCartController/getAllGoodsForShoppingCart").success(function(response) {
		    		    $scope.shoppingCartDetails = response; 
		    		    
		    		if (response.length <= 0) {
				$("#topCheckBox").attr('disabled',true); 
	            $("#noAnyProduct").show();
			}else{
			    $("#topCheckBox").attr('disabled',false); 
	        }   		    
		    		     
		});
		
		 $http.get("/shoppingCartController/loadShoppingCart").success(function(response) {
		 		$scope.shappingCart=response;
		 		
		 	 var detailIdList =$scope.shappingCart.selectedCartDetailIdList;
		 	 
		 	 if(detailIdList.length==0){
		 	 				    $("#nextButton").attr('disabled',true); 
		 	 	}else{
		 	 				    $("#nextButton").attr('disabled',false); 
		 	 		}
		 	 
angular.forEach(detailIdList, function(data,index,array){
 $("#"+detailIdList[index]).attr("checked",'checked');   
     
});	

  if($scope.shappingCart.allSelected==1){
	    $("#topCheckBox").attr("checked",'checked');   
	  }
		 		
		 	});
		
	
	$scope.loadShoppingCart = function(){
		$http.get("/shoppingCartController/getAllGoodsForShoppingCart").success(function(response) {
		    		    $scope.shoppingCartDetails = response; 
		    		    
		    		    		if (response.length <= 0) {
				$("#topCheckBox").attr('disabled',true); 
	            $("#noAnyProduct").show();
			}else{
			    $("#topCheckBox").attr('disabled',false); 
	        }   
	        
		});
		
		 $http.get("/shoppingCartController/loadShoppingCart").success(function(response) {
		 		$scope.shappingCart=response;
		 		
		 	 var detailIdList =$scope.shappingCart.selectedCartDetailIdList;
		 	  if(detailIdList.length==0){
		 	 				    $("#nextButton").attr('disabled',true); 
		 	 	}else{
		 	 				    $("#nextButton").attr('disabled',false); 
		 	 		}
angular.forEach(detailIdList, function(data,index,array){
 $("#"+detailIdList[index]).attr("checked",'checked');   
     
});	
	
	  if($scope.shappingCart.allSelected==1){
	    $("#topCheckBox").attr("checked",'checked');   
	  }	 		
		 	});
	}
	
		$scope.selectOneItem = function(cartDetailId){
	    $http.get("/shoppingCartController/selectOneItem?cartDetailId="+cartDetailId).success(function(response) {
		    $scope.loadShoppingCart();
		});
	}
	$scope.subtraction = function(cartDetailId){
	    $http.get("/shoppingCartController/subtraction?cartDetailId="+cartDetailId).success(function(response) {
		    $scope.loadShoppingCart();
		});
	}
	$scope.delete = function(cartDetailId){
	    $http.get("/shoppingCartController/delete?cartDetailId="+cartDetailId).success(function(response) {
	        $scope.loadShoppingCart();
		});
	}
	$scope.add = function(cartDetailId){
	    $http.get("/shoppingCartController/oneMore?cartDetailId="+cartDetailId).success(function(response) {
		    $scope.loadShoppingCart();
		});
	}
	
	$scope.amountChange=function(cartDetailId,count){		
		
		if(count<1){
			
			alert('数量要大于0！');
			count=1;
			}
			
			if(count>10000){
				
		alert('一次最多选择10,000件！');

				count=10000;
				}
		
		
	    $http.get("/shoppingCartController/amountChange?cartDetailId="+cartDetailId+"&count="+count).success(function(response) {
		    $scope.loadShoppingCart();
		});
	}
	
	$scope.selectAll = function(){
		$http.get("/shoppingCartController/selectAll").success(function(response) {
		   $scope.loadShoppingCart();
		});
		
		
	}
		$scope.goToPay = function(){
		$http.get("/shoppingCartController/generateOrderByCart").success(function(response) {
		 
		    window.location.href="paymentInfo.html";
		   
		});
		
		
	}
	
	});
</script>
<body ng-app="productApp" ng-controller="product">
	
	
<div class="topBarDiv">
    <IFRAME NAME="content_frame" width=100% SRC="component/topBar.html?cat=product" frameborder = 0 height = "67px"></IFRAME>
</div>
<div class="container"  ng-cloak>
    <div id="decorContainer">
	    <div id="pageHeader">
		    <div id="headerLeft">
			    <h1>您的购物车</h1>
			</div>
			<div id="headerRight">
			    <div class="rightImg">
				    <img class="fakeImg"></img>
				    <img src="/js/images/5.png" class="realImg"></img>
				</div>
				<div class="rightImg">
				    <img class="fakeImg"></img>
				    <img src="/js/images/2.png" class="realImg"></img>
				</div>
				<div class="rightImg">
				    <img class="fakeImg"></img>
				    <img src="/js/images/1.png" class="realImg"></img>
				</div>
			</div>
		</div>
		<div id="shopTable" >
			<div id="tableHeader">
				<div class="checkBox" >
					<input type="checkbox" id="topCheckBox"  ng-click="selectAll()" onClick="checkBoxClick();">
				</div>
				<div class="itemName">
				    <p class="title">产品和服务</p>
				</div>
				<div class="itemPrice">
				    <p class="title">念念价格(元)</p>
				</div>
				<div class="itemAmout">
				    <p class="title">数量</p>
				</div>
				<div class="totalPrice">
				    <p class="title">小计(元)</p>
				</div>
				<div class="operation">
				    <p class="title">操作</p>
				</div>
			</div>
			<div id="noAnyProduct" hidden>
	            <h1>您的购物车里还没有任何物品</h1>
				<div id="goShoppingButton"><h2>去别的地方看看</h2></div>
	        </div>
			<div class="tableContent"  id={{shoppingCartDetail.cartDetailId+'_'}} ng-repeat="shoppingCartDetail in shoppingCartDetails" on-finish-render-filters>
				<div class="checkBox">
				    <input type="checkbox" onClick="checkSubClick();"  name="checkbox"  id="{{shoppingCartDetail.cartDetailId}}"  ng-click="selectOneItem(shoppingCartDetail.cartDetailId)">
				</div>
				<div class="itemName">
				    <div class="itemImg">
					    <img src={{'/js/images/'+shoppingCartDetail.imageUrl}}></img>
					</div>
					<div class="itemDesc inputContent">
					    <p class="title" id={{shoppingCartDetail.wishId}}>{{shoppingCartDetail.wishName}}</p>
						<p class="subTitle">{{shoppingCartDetail.wishDesc}}</p>
					</div>
				</div>
				<div class="itemPrice inputContent">
				    <p class="title">{{shoppingCartDetail.price}}</p>
				</div>
				<div class="itemAmout inputContent">
				    <div class="oneThird">
					    <div class="changeButton minusBitton" ng-click="subtraction(shoppingCartDetail.cartDetailId)" >
						    <span>-</span>
						</div>
					</div>
					<div class="oneThird">
			 <input id={{shoppingCartDetail.cartDetailId+'_amount'}} ng-model="shoppingCartDetail.amount"  ng-blur="amountChange(shoppingCartDetail.cartDetailId,shoppingCartDetail.amount)"  class="title titleNumber" type="number" style="color:#ff5274; height:20px;width:50px;text-align:center;vtical-align:middle; border: none; -webkit-appearance: none; outline:none;" autofocus="autofocus" >

					</div>
					<div class="oneThird">
					    <div class="changeButton"  ng-click="add(shoppingCartDetail.cartDetailId)">
						    <span>+</span>
						</div>
					</div>
				</div>
				<div class="totalPrice inputContent">
				    <p class="title titleNumber">{{shoppingCartDetail.selectedPrice}}</p>

				</div>
				<div class="operation inputContent">
				    <span class="glyphicon glyphicon-trash deleteButton  "   ng-click="delete(shoppingCartDetail.cartDetailId)" ></span>
				</div>
			</div>
		</div>
		<div id="shopSumm">
			<div id="rightSumm">
			    <div id="rigthTop">
				    <div id="rigthTopTitle">
					    <p class="title titleNumber"></p>
					
					</div>
					<div id="rigthTopContent">
					    <p class="title">共{{shappingCart.count}}件商品，共计￥：{{shappingCart.grossFee}} 元</p>
					
					</div>
				</div>
			</div>
			<div id="leftSumm">
			    <div class="continue">
			    <button>继续购物</button>
				</div>
				<div class="next">
				<button id="nextButton" ng-click="goToPay()">去结算</button>
				</div>
			</div>
		</div>
	</div>
</div>
<IFRAME NAME="content_frame" width=100% height=246 marginwidth=0 marginheight=0 SRC="/component/bottomBar.html" frameborder = 0></IFRAME>
</div>
<div class="coverDiv" hidden>
<div class="titleDiv">
<h1>??Ъ?х?</h1>
</div>
<IFRAME class="detailFrame" width=1165px marginwidth=0 marginheight=0 SRC="#" frameborder = 0></IFRAME>
<div class="closeCoverDiv"><span class="glyphicon glyphicon-remove"></span></div>
</div>
<div class="coverImageDiv" hidden>
<div class="closeCoverDiv"><span class="glyphicon glyphicon-remove"></span></div>
</div>
</body>
<script>
function checkSubClick(){
	var vcheckbox=document.getElementsByName("checkbox");
	var topCheckBox=document.getElementById("topCheckBox");
	for(var i=0;i<vcheckbox.length;i++)
	{
		if(vcheckbox[i].checked){
			topCheckBox.checked = true;
	    }
		else{
	        topCheckBox.checked = false;
	        allSelect=0;	
	        return;			
		}
	}
}
function checkBoxClick(){
	var vcheckbox=document.getElementsByName("checkbox");
	var topCheckBox=document.getElementById("topCheckBox");
		
	for(var i=0;i<vcheckbox.length;i++)
	{
		if(topCheckBox.checked){
	        vcheckbox[i].checked = true;		
	    }
		else{
	        vcheckbox[i].checked = false;				
	    }
	}
}
//window.onload=function(){

//	$("#nextButton").click(function() {
//		muskCurrentPage();
//		$.ajax({
//		    url: '/wishlist/generateOrderByCart',
//			type: 'POST',
//			contentType: "application/json; charset=UTF-8",
//			dataType:'json',
//			data: [],
//			success:function(data){
//				window.location.href='paymentInfo.html?orderId='+data.orderId;
//				unmusk();
//		    },
//			error: function(error) {
//				//$("#messageSent")[0].value = '';
//			}
//		});
//	});
//};


	
$(".continue").click(function() {
	    window.location.href='/productAndService.html';
	});
	
$("#goShoppingButton").click(function() {
	window.location.href='/productAndService.html';
});
</script>
</html>