<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head id="head">
<meta name="description" content="Bleum provides high performance software development teams that
								deliver smart solutions, helping you to exceed your customers��
								expectations for timely product delivery, zero defects, and a
								superior customer experience." /> 
<meta http-equiv="content-type" content="text/html; charset=UTF-8" /> 
<meta http-equiv="pragma" content="no-cache" /> 
<meta http-equiv="content-style-type" content="text/css" /> 
<meta http-equiv="content-script-type" content="text/javascript" /> 
<script src="/funeral/js/jquery-2.1.4.js"></script>
<script src="/funeral/js/jquery-ui.js"></script>
<script src="/funeral/js/sliderx.js"></script>
<script src="/funeral/js/angular-1.4.0-rc.2/angular.js"></script>
<link href="/funeral/js/bootstrap-3.3.6-dist/css/bootstrap.css" rel="stylesheet">
<script src="/funeral/js/bootstrap-3.3.6-dist/js/bootstrap.js"></script>

</head>

<style>
html {
    height: 100%;
}
body {
    margin: 0;
	text-align: center;
	height: 100%;
}
.carousel-control {
    background-image: none!important;
	width: 15px;
	height: 54px;
	width: 54px;
    top: 100px;
}
.arrowCoat {
	width: 54px;
    height: 54px;
    border-radius: 27px;
	background-color: #f6f6f6;
}
.arrowCoat .headerArrow {
	line-height: 45px;
	color: #c6c6c6;
	font-size: 50px;
	margin: 0;
}
#maskDiv {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1000;
    width: 100%;
    height: 100%;
    background-color: #ccc;
    opacity: 0.5;
}

  body {
    width: 1349px;
	padding: 0px;
	min-width: 1000px;
  }
}
.coverDiv {
    height: auto;
	width: 100%;
	top: 30px;
	bottom: 60px;
	text-align: center;
	position: fixed;
	z-index: 1001;
}
.coverDiv .detailFrame {
    height: 100%;
}
.closeCoverDiv {
	position: absolute;
	top: 0px;
	width: 35px;
	height: 35px;
	border-radius: 17px;
	border: 2px solid #979797;
	color: #979797;
	font-size: 30px;
	text-align: center;
	line-height: 35px;
	cursor: pointer;
}
.closeCoverDiv:hover {
	color: yellow;
	border: 2px solid yellow;
}
.titleDiv {
    width: 1165px;
	height: 40px;
	margin: 0 auto;
	background-color: #ccc;
	text-align: left;
}
.titleDiv h1 {
    margin: 0px;
	margin-left: 15px;
	font-size: 20px;
	line-height: 40px;
}


.productText{
	width: 230px;
  height: 159px;
  border-radius: 4px;
  background-color: #ffffff;
  box-shadow: 0 10px 20px 0 rgba(0, 0, 0, 0.2);
}

	.productCarousel {
	    width: 1120px;
		margin: 0 auto;
		padding-top: 40px;
	}
	.productItem {
	   width: 230px;
	   height: 360px;
	   position:relative;
	   left:70px;
		float: left;
		margin-right: 25px;
		border-bottom: 2px solid #ededed;
		box-shadow: 0px 5px 15px 0px rgba(0,0,0,0.15);
		background-color: #ffffff;
		border-radius: 4px;
		overflow: hidden;
		cursor: pointer;
		transition:box-shadow 0.3s;
	    -moz-transition:box-shadow 0.3s;
        -webkit-transition:box-shadow 0.3s;
        -o-transition:box-shadow 0.3s;
	}
	.productItem img{
	    height: 100%;
	    width: 100%;
	}
    .imgCoat {
        width: 230px;
        height: 200px;
    }
	.productItem:hover {
	    box-shadow: 0px 10px 20px 0px #ff5274;
	    box-shadow: 0px 5px 10px 0px #ff5274;
	}
	.productCarousel .carousel-control {
	    height: 54px;
		width: 54px;
        top: 180px;
		background-image: none;
	}
	.productCarousel .carousel-control.left {
	    left: -30px;
	}
    .productCarousel .carousel-control.right {
	    right: -30px;
	}
	.productCarousel .arrowCoat {
	    width: 54px;
		height: 54px;
		border-radius: 27px;
		background-color: #f6f6f6;
	}
	.productCarousel .arrowCoat .headerArrow {
	    line-height: 45px;
		color: #c6c6c6;
		font-size: 50px;
		margin: 0;
	}
	.productCarousel .carousel-indicators {
	    bottom: -45px;
	    bottom: -25px;
	}
	.productInfo {
	    padding-top: 0px;
		text-align: center;
		padding-top: 20px;
		padding-bottom: 20px;
	}
	.productInfo .header {
	    font-size: 15px;
		color: #3b3d40;
		margin-bottom: 5px;
		padding-top: 0px;
	}
	.productInfo .detail {
	    font-size: 12px;
		color: #f5274;
		margin-bottom: 10px;
		text-align:center;
	}
	#products {
	    padding-bottom: 0px;
	  }
	#products .item {
	    padding-bottom: 0px;
		overflow: auto;
	}
	.addWishButton {
	  cursor: pointer;
		border-radius: 3px;
		width: 130px;
		height: 28px;
		background-color: #ff5274;
		margin: 0px auto;
		text-align: center;
	}
	.addWishButton p {
	    color: white;
		font-size: 13px;
		line-height: 28px;
		float: left;
		width: 100%;
	}
	.addWishButton:hover {
	    background-color: #ff496d!important;
	}
	.addWishButton img {
	    float: left;
		margin-top: 5px;
	}
	.moreInfo {
	    border-top: 1px solid #ededed;
	}
	.moreInfo a{
	    line-height: 30px;
		color: #3078c0;
		font-size: 13px;
		border: 0px;
	}
	.disableDiv {
	    opacity: 0.5;
	}
	iframe{
	   text-align: center;
	}
</style>
<script type="text/javascript">
var filter = location.search;
var app = angular.module('productApp', []);
var wishList;
var flag = {};
function validateInList() {
    $.ajax({
		url: '/funeral/wishlistDetail/getAllWishList?wishlistId='+wishList[0].wishlistId,
		type: 'get',
		success:function(data){
			var response = data;
			for (var i=0;i<response.length;i++) {
			    var wishInList = response[i];
				if ($("#"+wishInList.wishId).length > 0) {
				    $("#"+wishInList.wishId).find(".addWishButton").addClass("disableDiv");
				}
			}
			if ($(".disableDiv").length>0) {
			    for (var i=0;i<$(".disableDiv").length;i++) {
			        $(".disableDiv").find("p")[i].innerText = "已加入愿望清单";
				}
			}
		},
		error: function(error) {
			var response = error;
			//$(".disableDiv").find("p")[0].innerText = "已加入愿望清单";
		}
	});
}
window.parent.checkUserLogin(flag);
app.controller('products', function($scope, $http) {



    if (flag.code === 1) {
	    $http.get("/funeral/wishlist/list").success(function(response) {
	        wishList=response;
            validateInList();
	    });
    }
	$http.get("/funeral/wish/list"+filter).success(function(response) {
	    var j = 1,
		    counter = 1,
		    numberInRow = 4,
			objectsInRow = [],
			layouts = [];
		for (var i=0;i<response.length;i++) {
		    var singleProduct = response[i];

			if (j <= numberInRow) {
			    objectsInRow.push(singleProduct);
			}

			if (j === numberInRow || i === response.length-1) {
			    var layout = {},
				    active = '',
					itemLayout = objectsInRow;
					
				if (counter === 1) {
				    active = 'active'
				}
				layout = {
				    'index': counter,
					'active': active,
					'itemLayout': itemLayout
				};
				layouts.push(layout);
			    j = 0;
				counter++;
				objectsInRow = [];
			}
			j++;
		}
		$scope.layouts = layouts;
	});
});
</script>
<body ng-app="productApp" ng-controller="products" onselectstart="return false">
<div class="container" ng-cloak>
<div id="products">
	<div class="carouselProduct">
	    <div class="carousel slide productCarousel" id="referenceCarousel">
			<ol class="carousel-indicators">
				<li data-target="#referenceCarousel" data-slide-to="{{$index}}" class="{{layout.active}}" ng-repeat="layout in layouts"></li>
			</ol>
            <div class="carousel-inner">
				<div class="item {{layout.active}}"  ng-repeat="layout in layouts">
	                <div class="productItem" id="{{itemLayout.wishId}}" ng-repeat="itemLayout in layout.itemLayout track by $index">
                        <div class="imgCoat"><img src="/funeral/js/images/{{itemLayout.imgUrl}}"></img></div>
						<div class="productText">
						    <div class="productInfo">
							    <p class="header">{{itemLayout.wishName}}</p>
								<p class="detail">(单品价格:￥{{itemLayout.sellingPrice}})</p>
								<div class="addWishButton" onselectstart="return false" >
								  
								    <p>+&nbsp;添加至愿望清单</p>
								</div>
							</div>
							<div class="moreInfo"><a href="{{itemLayout.url}}" class="moreInfo">了解详情</a></div>
						</div>
		            </div>
                </div>
            </div>
            <a class="carousel-control left" href="#referenceCarousel" 
                data-slide="prev"><div class="arrowCoat"><p class="headerArrow">&lsaquo;</p></div></a>
            <a class="carousel-control right" href="#referenceCarousel" 
                data-slide="next"><div class="arrowCoat"><p class="headerArrow">&rsaquo;</p></div></a>
        </div>
	</div>
</div>
</body>
<script>
function addToWishlist(object) {
	if (!object.hasClass("disableDiv")){
	    var data = {
			"wishId": object.closest('.productItem')[0].id
		},
		dataList = [];
		
	//	alert("id= "+object.closest('.productItem')[0].id);
	
	
	//alert("id= "+object.closest('.productItem')[0].id+"  wishlistId="+wishList[0].wishlistId);
		
	    dataList.push(data);
		$.ajax({
			url: '/funeral/wishlistDetail/addSingle?wishlistId='+wishList[0].wishlistId,
			type: 'post',
			contentType: "application/json; charset=UTF-8",
			data: JSON.stringify(dataList),
			dataType:'json',
			success:function(data){
				alert("已加入愿望清单！");
			},
			error: function(error) {
				alert("已加入愿望清单！");
			}
		});
		
		object.addClass("disableDiv");
		object.find('p')[0].innerText = '已加入愿望清单';
	}
}
window.onload=function(){
    $("body").on("click",".productItem",function() {
	    window.parent.muskPageForProduct($(this)[0].id);
	});
	$("body").on("click",".addWishButton",function(event) {
	    if (flag.code === 1) {
	    	addToWishlist($(this));
	    	event.stopPropagation(); 
	    }
	    else {
	    	window.parent.popupLogInPage();
	    	event.stopPropagation(); 
	    }
	});
};
</script>
</html>