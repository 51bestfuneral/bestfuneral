<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head id="head"><title>
    Wish List
</title>
<meta name="description" content="念念网致力于打造智能葬礼产品和服务定制工具。念念主张“不要让你爱的人走的太匆忙”，鼓励充分尊重逝者意愿的提前定制，已实现“殡葬服务价格透明化、互联网化、个性化”为己任 。念念，也是中国最大的日系骨灰盒骨灰坛销售公司，最有特色的祭扫祭祀用品服务商。" /> 
<meta name="keywords" content="念念,念念网,葬礼定制,殡葬,上海殡葬,殡葬服务,上海墓地， 骨灰盒，骨灰坛，寿衣，日本骨灰盒，葬礼花费，佛事服务，私人定制，生前契约，葬礼保险,提前定制" /> 
<meta http-equiv="content-type" content="text/html; charset=utf-8" /> 
<meta http-equiv="pragma" content="no-cache" /> 
<meta http-equiv="content-style-type" content="text/css" />
<meta http-equiv="content-script-type" content="text/javascript" /> 
<link href="/css/wishList.css" rel="stylesheet">
<script src="/js/jquery-2.1.4.js"></script>
<script src="/js/angular-1.4.0-rc.2/angular.js"></script>
<link href="/js/bootstrap-3.3.6-dist/css/bootstrap.css" rel="stylesheet">
<script src="/js/generalUsage.js"></script>
</head>
<header>
</header>
<script type="text/javascript">
    var app = angular.module('productApp', []);
    app.controller('product', function($scope, $http) {  
    	$http.get("/shoppingCartController/getAllGoodsForShoppingCart").success(function(response) {
	            $scope.wishListDetails = response;
				if (response.length <= 0) {
					
						    	$("#topCheckBox").attr('disabled',true); 

				    $("#noAnyProduct").show();
				}else{
											    	$("#topCheckBox").attr('disabled',false); 

					}
	        });
	        
	  $http.get("/shoppingCartController/loadShoppingCart").success(function(response) {
	    $scope.shappingCart=	response;
	    
	     
	    var gross=parseFloat($scope.shappingCart.grossFee);
	     if( gross>0   ){
	  	$("#nextButton").attr('disabled',false); 
	  		
	  	
     } else{
	   	$("#nextButton").attr('disabled',true); 
	   		
    	}
	    
	     if($scope.shappingCart.allSelected==1){
	    $("#topCheckBox").attr("checked",'checked');   
	  }
	  
	  
	 var detailIdList =$scope.shappingCart.selectedCartDetailIdList;
angular.forEach(detailIdList, function(data,index,array){
 $("#"+detailIdList[index]).attr("checked",'checked');   
     
});
	   });      
	 
    
    	       
$scope.loadShoppingCart = function(){	   
   		
	   
			$http.get("/shoppingCartController/getAllGoodsForShoppingCart").success(function(response) {
	            $scope.wishListDetails = response;
				if (response.length <= 0) {
					
						    	$("#topCheckBox").attr('disabled',true); 

				    $("#noAnyProduct").show();
				}else{
											    	$("#topCheckBox").attr('disabled',false); 

					}
	        });
	        
	  $http.get("/shoppingCartController/loadShoppingCart").success(function(response) {
	    $scope.shappingCart=	response;
	    
	     
	    var gross=parseFloat($scope.shappingCart.grossFee);
	     if( gross>0   ){
	  	$("#nextButton").attr('disabled',false); 
	  		
	  	
     } else{
	   	$("#nextButton").attr('disabled',true); 
	   		
    	}
	    
	     if($scope.shappingCart.allSelected==1){
	    $("#topCheckBox").attr("checked",'checked'); 
	      
	  }
	 var detailIdList =$scope.shappingCart.selectedCartDetailIdList;
angular.forEach(detailIdList, function(data,index,array){
 $("#"+detailIdList[index]).attr("checked",'checked');   
     
});
	   });      
   	}
	        
//			$http.get("/shoppingCartController/getAllGoodsForShoppingCart").success(function(response) {
//	            $scope.wishListDetails = response;
//				if (response.length <= 0) {
//				    $("#noAnyProduct").show();
//				}
//	        });
//	        
//	  $http.get("/shoppingCartController/loadShoppingCart").success(function(response) {
//	    $scope.shappingCart=	response;
//	    
//	     if($scope.shappingCart.allSelected==1){
//	    $("#topCheckBox").attr("checked",'checked');   
//	  }
//	    
//	 var detailIdList =$scope.shappingCart.selectedCartDetailIdList;
//angular.forEach(detailIdList, function(data,index,array){
// $("#"+detailIdList[index]).attr("checked",'checked');   
//     
//});
//	   });          
 $scope.subtraction = function(wishDetailId){
	     	 	 $http.get("/shoppingCartController/subtraction?cartDetailId="+wishDetailId).success(function(response) {
	     	 	 		$scope.loadShoppingCart();
	     	 	 	});
	     	 	 	}
	     	 	 	
	     	 	 	 $scope.delete = function(wishDetailId){

	     	 	 $http.get("/shoppingCartController/delete?cartDetailId="+wishDetailId).success(function(response) {

	     	 	 		$scope.loadShoppingCart();
	     	 	 	});
	     	 	 	}
	     	 	 	
	     	 	 	
	     	 	 	$scope.add = function(wishDetailId){
	     	 	 $http.get("/shoppingCartController/oneMore?cartDetailId="+wishDetailId).success(function(response) {
	     	 	 	$scope.loadShoppingCart();
	     	 	 	});
	     	 	 	}
	   
	    
	    
	    
	     $scope.selectOneItem = function(cartDetailId,wishlistId){
	    $http.get("/shoppingCartController/selectOneItem?cartDetailId="+cartDetailId).success(function(response) {
	    
	  $scope.loadShoppingCart();
	 
	
	   
	   }); 	
	    	
	     	
	     	}
	    
	      $scope.selectAll = function(){
	    $http.get("/shoppingCartController/selectAll").success(function(response) {
	    	
	    	var datadata = JSON.stringify($scope.shappingCart);
	     $http.get("/shoppingCartController/loadShoppingCart").success(function(response) {
	    $scope.shappingCart=	response;
	    
	        if($scope.shappingCart.allSelected==1){
	    $("#topCheckBox").attr("checked",'checked');   
	  }
	    
	 var detailIdList =$scope.shappingCart.selectedCartDetailIdList;
angular.forEach(detailIdList, function(data,index,array){
 $("#"+detailIdList[index]).attr("checked",'checked');   
     
});
	    
	    
	   });
	    	}); 	
	     	
	     	
	     	}
	    
	    
    });
	function calculate() {
	    var totalPrice = 0;
    
		for (i =0; i < $(".tableContent").length; i++) {
			var tableLine = $(".tableContent")[i];
		
			totalPrice = totalPrice + parseInt($(tableLine).find('.totalPrice').find('p')[0].innerText);		
		}
	//	$("#rigthTopTitle").find(".titleNumber")[0].innerText = totalPrice;
	//	$("#rigthTopTitle").find(".titleNumber")[2].innerText = totalPrice + parseInt($("#rigthTopTitle").find(".titleNumber")[1].innerText);
	}
	function calculateEachLine(tableRow) {
		var singlePrice = tableRow.closest('.tableContent').find('.itemPrice')[0].innerText,
			count = parseInt(tableRow.closest('.tableContent').find('.itemAmout').find('.titleNumber')[0].innerText);
			
		tableRow.closest('.tableContent').find(".totalPrice").find('.titleNumber')[0].innerText = singlePrice*count;
	}
	function sendUpdateRequest(tableRow, count) {
	    var tableLine = tableRow.closest('.tableContent'),
		    cartDetailId = tableLine[0].id,
			data = {
			    'count': count
			};

//alert("sendUpdateRequest  cartDetailId= "+cartDetailId);

//		$.ajax({
//			url: '/shoppingCartController/oneMore?cartDetailId='+cartDetailId,
//			data: data,
//			type: 'post',
//			dataType:'json',
//			success:function(data){
//			},
//			error: function(error) {
//			}
//		});
	}
	function sendDeleteRequest(tableRow) {
	    var tableLine = tableRow.closest('.tableContent'),
		    cartDetailId = tableLine[0].id;

	//	$.ajax({
	//		url: '/shoppingCartController/delete?cartDetailId='+cartDetailId,
	//		type: 'get',
	//		success:function(data){
	//		},
	//		error: function(error) {
	//		}
	//	});
	}
</script>
<body ng-app="productApp" ng-controller="product">
<div class="topBarDiv">
    <IFRAME NAME="content_frame" width=100% SRC="component/topBar.html?cat=product" frameborder = 0 height = "68px"></IFRAME>
</div>
<div class="container"  ng-cloak>
    <div id="decorContainer">
	    <div id="pageHeader">
		    <div id="headerLeft">
			    <h1>您的购物车</h1>
			</div>
			<div id="headerRight">
			    <div class="rightImg">
				    <img class="fakeImg"></img>
				    <img src="/js/images/5.png" class="realImg"></img>
				</div>
				<div class="rightImg">
				    <img class="fakeImg"></img>
				    <img src="/js/images/2.png" class="realImg"></img>
				</div>
				<div class="rightImg">
				    <img class="fakeImg"></img>
				    <img src="/js/images/1.png" class="realImg"></img>
				</div>
			</div>
		</div>
		<div id="shopTable">
			<div id="tableHeader">
				<div class="checkBox" >
					<input type="checkbox" id="topCheckBox"  ng-click="selectAll()" onClick="checkBoxClick();">
				</div>
				<div class="itemName">
				    <p class="title">产品和服务</p>
				</div>
				<div class="itemPrice">
				    <p class="title">念念价格(元)</p>
				</div>
				<div class="itemAmout">
				    <p class="title">数量</p>
				</div>
				<div class="totalPrice">
				    <p class="title">小计(元)</p>
				</div>
				<div class="operation">
				    <p class="title">操作</p>
				</div>
			</div>
			<div id="noAnyProduct" hidden>
	            <h1>您的购物车里还没有任何物品</h1>
				<div id="goShoppingButton"><h2>去别的地方看看</h2></div>
	        </div>
			<div class="tableContent"   ng-repeat="wishListDetail in wishListDetails">
				<div class="checkBox">
				    <input type="checkbox" onClick="checkSubClick();"  name="checkbox"  id="{{wishListDetail.cartDetailId}}"  ng-click="selectOneItem(wishListDetail.cartDetailId,wishListDetail.cartId)">
				</div>
				<div class="itemName">
				    <div class="itemImg">
					    <img src="{{wishListDetail.imageUrl}}"  alt="念念,念念网,葬礼定制,殡葬,上海殡葬,殡葬服务,上海墓地， 骨灰盒，骨灰坛，寿衣，日本骨灰盒，葬礼花费，佛事服务，私人定制，生前契约，葬礼保险,提前定制"></img>
					</div>
					<div class="itemDesc inputContent">
					    <p class="title">{{wishListDetail.wishName}}</p>
						<p class="subTitle">{{wishListDetail.wishDesc}}</p>
					</div>
				</div>
				<div class="itemPrice inputContent">
				    <p class="title">{{wishListDetail.price}}</p>
				</div>
				<div class="itemAmout inputContent">
				    <div class="oneThird">
					    <div class="changeButton minusBitton"  ng-click="subtraction(wishListDetail.cartDetailId)">
						    <span>-</span>
						</div>
					</div>
					<div class="oneThird">
				        <p class="title titleNumber">{{wishListDetail.amount}}</p>
					</div>
					<div class="oneThird">
					    <div class="changeButton"  ng-click="add(wishListDetail.cartDetailId)">
						    <span>+</span>
						</div>
					</div>
				</div>
				<div class="totalPrice inputContent">
				    <p class="title titleNumber">{{wishListDetail.selectedPrice}}</p>
				</div>
				<div class="operation inputContent">
				    <span class="glyphicon glyphicon-trash deleteButton"  ng-click="delete(wishListDetail.cartDetailId)"></span>
				</div>
			</div>
		</div>
		<div id="shopSumm">
			<div id="rightSumm">
			    <div id="rigthTop">
				    <div id="rigthTopTitle">
					    <p class="title titleNumber"></p>
					
					</div>
					<div id="rigthTopContent">
					    <p class="title">共{{shappingCart.count}}件商品，共计￥：{{shappingCart.grossFee}}</p>
					
					</div>
				</div>
			</div>
			<div id="leftSumm">
			    <div class="continue">
			    <button>继续购物</button>
				</div>
				<div class="next">
				<button id="nextButton">去结算</button>
				</div>
			</div>
		</div>
	</div>
</div>
<IFRAME NAME="content_frame" width=100% height=246 marginwidth=0 marginheight=0 SRC="/component/bottomBar.html" frameborder = 0></IFRAME>
</div>
<div class="coverDiv" hidden>
<div class="titleDiv">
<h1>物品详细信息</h1>
</div>
<IFRAME class="detailFrame" width=1165px marginwidth=0 marginheight=0 SRC="#" frameborder = 0></IFRAME>
<div class="closeCoverDiv"><span class="glyphicon glyphicon-remove"></span></div>
</div>
<div class="coverImageDiv" hidden>
<div class="closeCoverDiv"><span class="glyphicon glyphicon-remove"></span></div>
</div>
</body>
<script>
function checkSubClick(){
var vcheckbox=document.getElementsByName("checkbox");
var topCheckBox=document.getElementById("topCheckBox");

for(var i=0;i<vcheckbox.length;i++)
{
	if(vcheckbox.checked){
		topCheckBox.checked = true;

		}else{
topCheckBox.checked = false;
allSelect=0;	
return;			
				}
}


	

}	
function checkBoxClick(){
var vcheckbox=document.getElementsByName("checkbox");
var topCheckBox=document.getElementById("topCheckBox");
	
for(var i=0;i<vcheckbox.length;i++)
{
	if(topCheckBox.checked){
		
vcheckbox[i].checked = true;		
		}else{
vcheckbox[i].checked = false;				
				}
}
}
window.onload=function(){
    for (var j =0; j<$(".tableContent").length;j++) {
	    var tableLine = $($(".tableContent")[j]);
		calculateEachLine(tableLine);
	}
	calculate();
    $(".changeButton").click(function() {
	    var number = parseInt($(this).closest('.itemAmout').find(".titleNumber")[0].innerText),
		    changedNumber;

	    if ($(this).hasClass("minusBitton")) {
		    if (number>0) {
		        $(this).closest('.itemAmout').find(".titleNumber")[0].innerText = number - 1;
				changedNumber = number - 1;
			}
		}
		else {
		    $(this).closest('.itemAmout').find(".titleNumber")[0].innerText = number + 1;
			changedNumber = number + 1;
		}
		
		if (number != changedNumber) {
		    sendUpdateRequest($(this), changedNumber);
		    calculateEachLine($(this));
		    calculate();
		}
	});
	$(".deleteButton").click(function() {
	    $(this).closest('.tableContent').remove();
	    calculate();
		sendDeleteRequest($(this));
	});
	function muskPage() {
			$('<div class="jquery_addmask"> </div>').appendTo(document.body).css({ 
				position: 'absolute',
				top: '0px',
				left: '0px',
				'z-index': 1000, 
				width: $(document).width(), 
				height: $(document).height(), 
				'background-color': '#ccc', 
				opacity: 0 
			}).fadeIn('slow', function(){ 
				$(this).fadeTo('slow', 0.5); 
		});
	};
	$(".itemImg").click(function() {
	    muskPage();
	    $(".coverImageDiv").fadeIn();
	});
	$(".itemDesc").find(".title").click(function() {
			window.location.href = "/component/productDetail3.html?id="+$(this)[0].id;
	});
	$(".closeCoverDiv").click(function() {
		$(".coverDiv").fadeOut();
		$(".coverImageDiv").fadeOut();
		$(".jquery_addmask").remove();
		$(".productItem").css({
			 opacity: 1
		});
	});
	$("#nextButton").click(function() {
	    window.location.href='paymentInfo.html';
	});
	
};
$(".continue").click(function() {
	    window.location.href='/productAndService.html';
	});
$("#goShoppingButton").click(function() {
	window.location.href='/productAndService.html';
});
</script>
</html>